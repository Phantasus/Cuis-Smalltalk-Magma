MaSingleton subclass: #MagmaWorld	instanceVariableNames: 'domainVersion'	classVariableNames: ''	poolDictionaries: ''	category: 'Magma-Squeak-Client-Application'!!MagmaWorld commentStamp: 'cmm 12/28/2015 21:26' prior: 0!A MagmaWorld makes a good root of a Magma database. Any object can be the root of a Magma database, but by subclassing MagmaWorld for your application root, it can take advantage of the application hooks and services provided by Magma-Squeak.!!MagmaWorld methodsFor: 'actions' stamp: 'cmm 3/20/2017 16:53'!close	"Close down all windows holding objects of this application, and disconnect from the database."	self closeAndDisconnect.	MauiWorld current developerMode! !!MagmaWorld methodsFor: 'actions' stamp: 'cmm 1/5/2016 20:32'!closeAndDisconnect	"Close down all windows holding objects of this application, and disconnect from the database."	MaInstaller close: self! !!MagmaWorld methodsFor: 'accessing' stamp: 'cmm 9/6/2012 11:54'!domainVersion	"The MC version number for when this domain last changed its shape to a degree that requires legacy models to apply a conversion utility."	^ domainVersion! !!MagmaWorld methodsFor: 'accessing' stamp: 'cmm 9/6/2012 11:54'!domainVersion: mcVersionNumber	"The MC version number for when this domain last changed its shape to a degree that requires legacy models to apply a conversion utility."	domainVersion := mcVersionNumber! !!MagmaWorld methodsFor: 'initialize-release' stamp: 'cmm 1/7/2016 17:35'!initialize	super initialize.	domainVersion := self class domainVersion! !!MagmaWorld methodsFor: 'testing' stamp: 'cmm 12/29/2015 10:10'!isMagmaWorld	^ true! !!MagmaWorld methodsFor: 'private' stamp: 'cmm 8/7/2014 17:03'!validateDomainVersion	^ self domainVersion = self class domainVersion ifFalse: [ MagmaUserError signal: 'This repository is version ' , self domainVersion asString , ' but you are running version ' , self class domainVersion , ' of the code.  Please disconnect immediately and run the upgrade utility.' ]! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!MagmaWorld class	instanceVariableNames: ''!!MagmaWorld class methodsFor: 'actions' stamp: 'cmm 2/9/2017 22:40'!close	self		 closeMenu ;		 developerModeOff.	current ifNotNil: [ current close ].	self reset! !!MagmaWorld class methodsFor: 'actions' stamp: 'cmm 2/10/2017 17:18'!developerModeOff	(Smalltalk classNamed: #MauiWorld) ifNotNil:		[ : mauiWorld | mauiWorld current userMode ]! !!MagmaWorld class methodsFor: 'actions' stamp: 'cmm 2/10/2017 17:18'!developerModeOn	(Smalltalk classNamed: #MauiWorld) ifNotNil:		[ : mauiWorld | mauiWorld current developerMode ]! !!MagmaWorld class methodsFor: 'actions' stamp: 'cmm 2/9/2017 22:45'!open	self		 openMenu ;		 developerModeOff! !!MagmaWorld class methodsFor: 'actions' stamp: 'cmm 12/29/2015 14:02'!openConfigurationPanel	self installerClass new maui! !!MagmaWorld class methodsFor: 'actions' stamp: 'cmm 2/9/2017 22:02'!refresh	self current ifNotNil: [ self close ].	self reset! !!MagmaWorld class methodsFor: 'actions' stamp: 'cmm 12/29/2015 20:11'!saveDeployableDatabase	| appName |	appName := UIManager default		request: 'app name? (terse)'		initialAnswer: 'myapp'.	appName isEmptyOrNil ifFalse: [ self saveDeployableDatabaseNamed: appName ]! !!MagmaWorld class methodsFor: 'actions' stamp: 'cmm 12/30/2015 10:51'!saveDeployableDatabaseNamed: aString	| loc forDb |	self halt current isInMagma ifTrue: [ 'The current model is already in a Magma database.  This operation only works on new, non-persistent models.  To make a backup copy of this model, contact the database administrator.' ].	loc := (FileDirectory default / aString / 'model') asMagmaLocalLocation.	loc directory assureExistence.	forDb := self current.	self reset.	MagmaRepositoryController create: loc root: forDb.	loc deployExcluding: Array empty! !!MagmaWorld class methodsFor: 'initialize-release' stamp: 'cmm 2/9/2017 22:31'!closeMenu	MorphicProject current dockingBar: TheWorldMainDockingBar new! !!MagmaWorld class methodsFor: 'initialize-release' stamp: 'cmm 12/29/2015 16:47'!initialize	self registerInOpenMenu! !!MagmaWorld class methodsFor: 'initialize-release' stamp: 'cmm 2/9/2017 22:04'!openMenu	MorphicProject current dockingBar: self menuClass new! !!MagmaWorld class methodsFor: 'initialize-release' stamp: 'cmm 2/9/2017 22:11'!registerInOpenMenu	TheWorldMenu registerOpenCommand: {self properName. {self. #open}}! !!MagmaWorld class methodsFor: 'initialize-release' stamp: 'cmm 2/9/2017 22:11'!unload	TheWorldMenu unregisterOpenCommand: self properName! !!MagmaWorld class methodsFor: 'accessing' stamp: 'cmm 8/7/2014 17:00'!domainVersion	"Subclasses override."	^ nil! !!MagmaWorld class methodsFor: 'override' stamp: 'cmm 12/29/2015 13:56'!installerClass	"Applications provide thier own subclass of MagmaWorldMainDockingBar."	^ (Smalltalk classNamed: #MyInstaller) ifNil: [ MaInstaller ]! !!MagmaWorld class methodsFor: 'override' stamp: 'cmm 12/29/2015 16:27'!menuClass	"Applications provide thier own subclass of MagmaWorldMainDockingBar."	^ MagmaWorldMainDockingBar! !!MagmaWorld class methodsFor: 'override' stamp: 'cmm 12/29/2015 20:01'!properName	"Subclasses override with the name they want to appear in the Apps menu of Squeak."	^ 'Magma'! !!MagmaWorld class methodsFor: 'maui support' stamp: 'cmm 12/29/2015 11:02'!openMauiPanel	(Smalltalk classNamed: #MauiWorld) ifNotNil:		[ : mauiWorldClass | self current maui ]! !MagmaWorld initialize!