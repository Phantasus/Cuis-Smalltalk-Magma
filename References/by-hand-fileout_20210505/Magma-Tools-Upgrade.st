MaObject subclass: #MagmaUpgrader	instanceVariableNames: 'location definition session'	classVariableNames: ''	poolDictionaries: ''	category: 'Magma-Tools-Upgrade'!!MagmaUpgrader methodsFor: 'initialize-release' stamp: 'cmm 8/5/2011 16:28'!close	session ifNotNil: [ session disconnectAndClose ]! !!MagmaUpgrader methodsFor: 'initialize-release' stamp: 'cmm 8/5/2011 14:00'!setLocation: aMagmaLocation	location := aMagmaLocation! !!MagmaUpgrader methodsFor: 'accessing' stamp: 'cmm 8/5/2011 14:19'!definition	"Answer the repository definition."	^ definition ifNil: [ definition := self session definition ]! !!MagmaUpgrader methodsFor: 'accessing' stamp: 'cmm 8/7/2011 21:29'!session	^ session ifNil:		[ session := location newSession			 userId: 'upgrader from 15 to 16' ;			 ensureConnected ;			 yourself ]! !!MagmaUpgrader methodsFor: 'private' stamp: 'cmm 8/5/2011 16:34'!legacyVersion	self subclassResponsibility ! !!MagmaUpgrader methodsFor: 'private' stamp: 'cmm 8/7/2011 18:30'!newVersion	^ self legacyVersion+1! !!MagmaUpgrader methodsFor: 'private' stamp: 'cmm 8/7/2011 20:02'!newVersionLocation	^ MagmaLocalLocation path: location path , '.v', self newVersion asString! !!MagmaUpgrader methodsFor: 'private' stamp: 'cmm 8/5/2011 14:14'!prepareModel	self subclassResponsibility! !!MagmaUpgrader methodsFor: 'private' stamp: 'cmm 8/7/2011 18:30'!setVersion	| filer |	MagmaNotification signal: 'Setting version to ', self newVersion.	filer := MaObjectFiler open: self newVersionLocation directory.	filer version: self legacyVersion + 1.	filer close! !!MagmaUpgrader methodsFor: 'private' stamp: 'cmm 8/5/2011 14:14'!upgradeBuffers	self subclassResponsibility! !!MagmaUpgrader methodsFor: 'private' stamp: 'cmm 8/5/2011 16:34'!verifyRunningLegacyVersion	MagmaSession magmaVersion = self legacyVersion! !!MagmaUpgrader methodsFor: 'private' stamp: 'cmm 8/5/2011 14:00'!warn	self subclassResponsibility! !!MagmaUpgrader methodsFor: 'upgrade' stamp: 'cmm 8/5/2011 14:10'!postUpgrade	"Code to run with new version of Magma."	self postUpgradeModel! !!MagmaUpgrader methodsFor: 'upgrade' stamp: 'cmm 8/7/2011 18:29'!upgrade	[ [ self		 verifyRunningLegacyVersion ;		 warn ;		 prepareModel ;		 verifyCanUpgrade ;		 upgradeBuffers ;		 setVersion.		 MagmaNotification signal: 'Upgrade complete.' ] ensure: [ self close ] ]		on: MaNotification		do:			[ : noti | Transcript				 cr ;				 show: noti messageText.			noti resume ]! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!MagmaUpgrader class	instanceVariableNames: ''!!MagmaUpgrader class methodsFor: 'instance creation' stamp: 'cmm 8/5/2011 14:00'!location: aMagmaLocation 	^ self new		 setLocation: aMagmaLocation ;		 yourself! !